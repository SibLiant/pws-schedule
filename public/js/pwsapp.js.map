{"version":3,"sources":["pwsnamespace.js","pwscore.js","pwsrender.js","pwsworker.js","pwsworkercollection.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1JA","file":"pwsapp.js","sourcesContent":["var PWSSchedule = PWSSchedule || {};\n\nPWSSchedule.createNS = function (namespace) {\n    var nsparts = namespace.split(\".\");\n    var parent = PWSSchedule;\n \n    // we want to be able to include or exclude the root namespace so we strip\n    // it if it's in the namespace\n    if (nsparts[0] === \"PWSSchedule\") {\n        nsparts = nsparts.slice(1);\n    }\n \n    // loop through the parts and create a nested namespace if necessary\n    for (var i = 0; i < nsparts.length; i++) {\n        var partname = nsparts[i];\n        // check if the current parent already has the namespace declared\n        // if it isn't, then create it\n        if (typeof parent[partname] === \"undefined\") {\n            parent[partname] = {};\n        }\n        // get a reference to the deepest element in the hierarchy so far\n        parent = parent[partname];\n    }\n    // the parent is now constructed with empty namespaces and can be used.\n    // we return the outermost namespace\n    return parent;\n};\n","/*global PWSSchedule, moment */\nPWSSchedule.core = function(options){\n\t\"use strict\";\n\t\n\tvar scheduleWorkers = options.workerRecords;\n\tvar config = {\n\t\t\"momCalStart\": moment( options.calendarRange.start ),\n\t\t\"momCalEnd\": moment( options.calendarRange.end ),\n\t\t\"pwsDateFormat\": 'YYYY-MM-DD',\n\t\t\"headerDateFormat\": 'ddd MMM D',\n\t\t\"navBackward\": options.settings.navBackward,\n\t\t\"navForward\": options.settings.navForward,\n\t\t\"navRootUrl\": options.settings.navRootUrl,\n\t\t\"calendarName\": options.settings.name\n\t};\n\n\tconfig.calRangeInt = config.momCalEnd.diff( config.momCalStart, \"days\" );\n\n\tvar scheduleRecordsByWorkerId = (function(){\n\t\tvar proj = [];\n\t\t$.each(options.scheduleRecords, function(k,v) {\n\t\t\tif ( ! proj.hasOwnProperty(v.worker_id) ) { proj[v.worker_id] = []; }\n\t\t\tproj[v.worker_id].push(v);\n\t\t});\n\t\treturn proj;\n\t})();\n\n\tvar workers = (function (){\n\t\tvar wrk = {};\n\t\t$.each(scheduleWorkers, function( index, value ) {\n\t\t\tvar obj = new PWSSchedule.worker(value.worker_id, value.worker_name, scheduleRecordsByWorkerId[value.worker_id]);\n\t\t\twrk[index] =  obj;\n\t\t});\n\t\treturn wrk;\n\t})();\n\n\treturn {\n\t\toptions:options,\n\t\tconfig:config,\n\t\tscheduleRecordsByWorkerId:scheduleRecordsByWorkerId,\n\t\tworkers:workers\n\t};\n \n};\n","/*global PWSSchedule, moment */\n/*exported  getCalStart, getCalRange, setCalStart */\n/* jshint unused:false */\nPWSSchedule.render = function( core ){\n\t\"use strict\";\n\n\n\tvar projectSelected = {};\n\tvar hdrTarget = null;\n\n\tvar bldGridHeader = function(targetElement){\n\t\t//clear any existing elements\n\n\t\tif ( targetElement ){\n\t\t\thdrTarget = ( targetElement instanceof jQuery ) ? targetElement : $( targetElement );\n\t\t}\n\n\t\tvar hdrdivs = [];\n\t\t$('div.hdr-row').html('');\n\n\t\t//build the controls first\n\t\thdrdivs.push('<div id=\"name-placeholder\"> <a href=\"#\" id=\"cal-ctrl-back\" class=\"btn\"><</a> &nbsp; &nbsp; <a href=\"#\" id=\"cal-ctrl-forward\" class=\"btn\">></a> </div>');\n\t\tvar i;\t\t\t\t\t\t\n\n\t\tfor(i=0; i < core.config.calRangeInt; i++){\n\t\t\tvar dy = core.config.momCalStart.clone().add(i, 'days');\n\t\t\tvar cls = ( isWeekend(dy) ) ? 'cnt-hdr-date weekend' :  'cnt-hdr-date';\n\t\t\thdrdivs.push('<div class=\"'+cls+'\">'+ core.config.momCalStart.clone().add(i, 'days').format(core.config.headerDateFormat)+' </div>');\n\t\t}\n\t\thdrTarget.append(hdrdivs);\n\t\tsetCalendarName();\n\t};\n\n\tvar isWeekend = function(mom){\n\t\t\n\t\treturn (  mom.weekday() === 0 || mom.weekday() === 6 ) ? true : false;\n\n\t};\n\n\tvar initScheduleRecords = function(){\n\t\tvar rws;\n\t\t$.each(core.workers, function( workerIndex, worker ) {\n\t\t\tbuildWorkerDays( worker.id );\n\t\t\trws = worker.buildRows(core.config.momCalStart, core.config.calRangeInt);\n\t\t\t//console.debug(rws);\n\t\t\t$.each(rws, function( rowIndex, row ) {\n\t\t\t\t//console.debug(row);\n\t\t\t\trenderWorkerRow( worker.id, row  );\n\t\t\t});\n\t\t});\n\t};\n\n\tvar reRender = function(){\n\t\tbldGridHeader();\n\t\tinitScheduleRecords();\n\t\tctrlBind();\n\n\t\tvar scrollHeader = document.getElementById('cnt-scroll-header');\n\t\tvar scrollWorkers = document.getElementById('calendar-workers-scrollable');\n\t\tvar scrollWkGrids = document.getElementById('cnt-worker-grids');\n\t\tif ( scrollHeader  ) { scrollHeader.scrollLeft = 0; }\n\t\tif ( scrollWorkers ) { scrollWorkers.scrollLeft = 0; }\n\t\tif ( scrollWkGrids ) { scrollWkGrids.scrollLeft = 0; }\n\n\t};\n\n\tvar navCal = function(direction, days){\n\t\tif ( core.config.navRootUrl ) { \n\t\t\tcalNavRootUrl(direction); \n\t\t}\n\t\tif ( direction === 'forward' ) {\n\t\t\tcore.config.momCalStart.add( days, 'days' );\n\t\t\tcore.config.momCalEnd.add( days, 'days' );\n\t\t}\n\n\t\tif ( direction === 'backward' ) {\n\t\t\tcore.config.momCalStart.subtract( days, 'days' );\n\t\t\tcore.config.momCalEnd.subtract( days, 'days' );\n\t\t}\n\t\treRender();\n\t};\n\n\tvar calNavRootUrl = function(direction){\n\n\t\tvar newTargetDate;\n\t\tif ( direction === \"forward\" ) {\n\t\t\tnewTargetDate = core.config.momCalStart.clone().add( core.config.navForward, 'days' );\n\t\t}\n\t\telse { //backward\n\t\t\tnewTargetDate = core.config.momCalStart.clone().subtract( core.config.navBackward, 'days' );\n\t\t}\n\n\t\tvar url = core.config.navRootUrl + '/' + newTargetDate.format( core.config.pwsDateFormat );\n\t\twindow.location = url;\n\t\tthrow new Error( 'Redirecting' );\n\n\t};\n\n\tvar clearWorkerScheduleElements = function(worker_id){\n\t\tvar momStart = core.config.momCalStart.clone();\n\t\tvar rng = core.config.calRangeInt;\n\t\tfor (var i = 0; i < rng; i++) { \n\t\t\tvar select = bldDaySelector(worker_id, momStart.clone().add(i, 'days'));\n\t\t\t$(select).html('');\n\t\t}\n\n\t};\n\n\tvar clearWorkerDayDivs = function(worker_id){\n\t\t//var select = $('#worker-row_'+worker_id).html('');\n\t\tvar select = $('#worker-row_'+worker_id).children();\n\t\t$.each(select, function( index, value ) {\n\t\t\tif ( $(value).hasClass('worker-day')  ) { $(value).remove(); }\n\t\t});\n\n\t};\n\n\tvar renderWorkerRow = function(worker_id, wRow){\n\n\t\tvar momPrevProj = core.config.momCalStart.clone();\n\t\tvar rlen = wRow.length;\n\t\tvar dDiff;\n\t\tfor (var i = 0; i < rlen; i++) { \n\t\t\tvar momCurrentProj = moment( wRow[i].scheduled_date );\n\t\t\tdDiff = momCurrentProj.diff( momPrevProj, 'days');\n\n\t\t\tif (  dDiff > 0 ) { renderPlaceHolder(worker_id, momPrevProj, dDiff);}\n\t\t\trenderWorkerProj(worker_id, wRow[i]);\n\t\t\tmomPrevProj = moment( wRow[i].scheduled_date ).add( wRow[i].job_length_days, 'days' );\n\t\t}\n\t\tdDiff = core.config.momCalEnd.diff( momPrevProj, 'days' );\n\t\tif (  dDiff > 0   )  { \n\t\t\t\n\t\t\tconsole.debug('---------');\n\t\t\tconsole.debug('end row place holders');\n\t\t\tconsole.debug( core.config.momCalEnd );\n\t\t\tconsole.debug('---------');\n\t\t\trenderPlaceHolder(worker_id, momPrevProj, dDiff);\n\t\t}\n\t};\n\n\tvar renderPlaceHolder = function(worker_id, start, days){\n\t\tvar momStart =  ( moment.isMoment(start) ) ? start.clone() : moment( start );\n\t\tvar proj;\n\t\tvar selector;\n\t\tvar cls;\n\t\tdays = ( ! days ) ? 1 : days;\n\t\tif ( days === 1 ){\n\t\t\tcls = \"place-holder_\"+ worker_id + \"_\"+ momStart.format(core.config.pwsDateFormat);\n\t\t\tproj = '<div class=\"cnt-project place-holder '+cls+'\"> place holder</div>';\n\t\t\tselector = bldDaySelector(worker_id, momStart);\n\t\t\t$( selector ).append(proj);\n\t\t}\n\t\telse {\n\t\t\tfor( var u=0; u<days;u++){\n\t\t\t\tvar momStartClone = momStart.clone();\n\t\t\t\tvar tDay = momStartClone.add(u, 'days').format(core.config.pwsDateFormat);\n\t\t\t\tvar classDt = 'place-holder_' + worker_id + '_' + tDay;\n\t\t\t\tproj = '<div class=\"cnt-project place-holder '+classDt+'\"> place holder</div>';\n\t\t\t\tselector = bldDaySelector(worker_id, tDay);\n\t\t\t\t$( selector ).append(proj);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar renderWorkerProj = function(worker_id, scheduleRecord){\n\t\tvar dys = parseInt(scheduleRecord.job_length_days);\n\t\tvar momentDrawDay;\n\t\tfor(var j=0;j<dys;j++){\n\t\t\t// we need to determin what class to apply to the project so the \n\t\t\t// project appears to span days nicely \n\t\t\tvar cls;\n\t\t\tif (dys === 1) { cls = \"proj-single\"; }\n\t\t\telse if (j === 0) { cls = \"proj-begin\"; }\n\t\t\telse if (  j > 0 && j+1 < dys ) { cls = \"proj-mid\"; }\n\t\t\telse if ( j + 1 === dys ) { cls = \"proj-end\"; }\n\n\t\t\tvar id = 'schedule-id_'+scheduleRecord.schedule_id+'_dy_'+ Math.abs(j+1);\n\t\t\t//verfiy if we have a sane project id\n\n\t\t\tvar proj = '<div class=\"proj-draggable cnt-project '+cls+'\" id=\"'+id+'\"> <span class=\"proj-name\">'+scheduleRecord.customer_name+'</span><span class=\"proj-cust-name\"></span></div>';\n\t\t\tmomentDrawDay = moment(scheduleRecord.scheduled_date).add(j, 'days');\n\n\t\t\tvar selector = bldDaySelector(worker_id, momentDrawDay.format(core.config.pwsDateFormat));\n\n\t\t\t$( selector ).append(proj);\n\t\t\t$('#'+id).data('scheduleRecord', scheduleRecord );\n\n\t\t}\n\t\t//return the last draw day so we can look at the next record and determine\n\t\t//if we need to add invisable place holders to keep a nice cal format\n\t\treturn momentDrawDay;\n\t};\n\n\tvar bldDaySelector = function(worker_id, day){\n\t\tvar mom =  ( moment.isMoment(day) ) ? day.clone() : moment( day );\n\t\treturn '#worker-id_'+worker_id+'_day_'+mom.format(core.config.pwsDateFormat);\n\t};\n\n\tvar  initWorkerDivs = function(targetElement){\n\t\tvar jqObjTarget = ( targetElement instanceof jQuery ) ? targetElement : $( targetElement );\n\t\tvar workerDivs = [];\n\t\t$.each(core.workers, function( index, value ) {\n\t\t\tbuildWorkerDiv(value.id, value.name, jqObjTarget);\n\t\t});\n\t};\n\n\tvar setCalendarName = function(){\n\n\t\t$('#calendar-name').html(core.config.calendarName);\n\n\n\t};\n\n\tvar buildWorkerDiv = function(worker_id, worker_name, targetElement){\n\t\t//var jqObjTarget = ( targetElement instanceof jQuery ) ? targetElement : $( targetElement );\n\t\ttargetElement = $( targetElement );\n\t\tvar workerDivs = [];\n\n\t\tvar workerCntId = 'worker-row_'+ worker_id;\n\t\tvar divString = '<div class=\"proj-droppable worker-row\" id=\"'+workerCntId+'\"> <div class=\"worker-name\">'+worker_name+'</div> </div> <!-- worker-row -->\t';\n\t\ttargetElement.append(divString);\n\t\t\n\t\t//build day containers\n\t\tbuildWorkerDays( worker_id);\n\t};\n\n\tvar buildWorkerDays = function(worker_id){\n\t\tvar daysDivs = [];\n\t\tclearWorkerDayDivs( worker_id );\n\t\tfor(var i = 0; i < core.config.calRangeInt; i++){\n\n\t\t\tvar dy = core.config.momCalStart.clone().add(i, 'days');\n\t\t\tvar cls = ( isWeekend(dy) ) ? 'weekend' :  '';\n\t\t\tdaysDivs.push('<div class=\"proj-droppable worker-day '+cls+'\" id=\"worker-id_'+worker_id+'_day_'+ core.config.momCalStart.clone().add(i, 'days').format(core.config.pwsDateFormat)+'\"> </div>');\n\t\t}\n\t\t$('#worker-row_'+worker_id).append(daysDivs);\n\t};\n\n\n\tvar setProjUnselected = function(){\n\t\tif ( $.isEmptyObject( projectSelected ) ) { return; }\n\t\tfor (var i = 0; i < projectSelected.job_length_days; i ++) {\n\t\t\tvar select =  '#schedule-id_'+projectSelected.schedule_id+'_dy_'+ Math.abs(i+1);\n\t\t\t$( select ).removeClass('proj-selected');\n\t\t}\n\t\tprojectSelected = {};\n\t\t$('#selected-project').html('');\n\t};\n\n\tvar setProjSelected = function(p){\n\t\tfor (var i = 0; i < p.job_length_days; i ++) {\n\t\t\tvar select =  '#schedule-id_'+p.schedule_id+'_dy_'+ Math.abs(i+1);\n\t\t\t$( select ).addClass('proj-selected');\n\t\t}\n\t\tprojectSelected = p;\n\t\treturn p;\n\t};\n\n\tvar updateSelectedProjectDisplay = function (){\n\t\t$('#selected-project').html('');\n\t\tvar proj = '<li>'+projectSelected.customer_name+'</li>';\n\t\t$('#selected-project').append(proj);\n\t\tsetTagStyles();\n\t};\n\n\tvar setTagStyles = function(){\n\t\t$.each(projectSelected.tags, function( index, value ) {\n\t\t\trenderTag( value );\n\t\t});\n\t};\n\n\tvar renderTag = function(tagId){\n\t\tvar tag = core.options.tags[tagId];\n\t\tvar styles = 'border-color: '+tag.border_color+'; background-color: '+tag.background_color+'; ';\n\t\t$('#selected-project').append('<li class=\"tag tag-tooltip\" id=\"tag-id_\"'+tagId+' style=\"'+styles+'\" tooltip=\"'+tag.tool_tip+'\">'+tag.abbreviation+'</li>');\n\t};\n\n\t// build all the controls that were dynamically built\n\tvar ctrlBind = function(){\n\n\t\t$('#cal-ctrl-back').click(function(e){\n\t\t\te.preventDefault();\n\t\t\tvar nBackward = core.config.navBackward;\n\n\t\t\tif ( core.config.calNavRootUrl  ) {\n\t\t\t\tvar momTargetDay = core.config.momCalStart.clone();\n\t\t\t\tmomTargetDay.subtract( core.config.navBackward, 'days' );\n\t\t\t\tcalNavRootUrl( momTargetDay );\n\t\t\t}\n\n\t\t\tnavCal( 'backward', nBackward  );\n\t\t});\n\n\t\t$('#cal-ctrl-forward').click(function(e){\n\t\t\te.preventDefault();\n\t\t\tvar nForward = core.config.navForward;\n\t\t\tif ( core.config.calNavRootUrl  ) {\n\t\t\t\tvar momTargetDay = core.config.momCalStart.clone();\n\t\t\t\tmomTargetDay.add( core.config.navForward, 'days' );\n\t\t\t\tcalNavRootUrl( momTargetDay );\n\t\t\t}\n\t\t\tnavCal( 'forward', nForward  );\n\t\t});\n\n\n\n\t\t$('.cnt-project').click(function(e){\n\t\t\t// user can click on other elements in the project div\n\t\t\t// make sure we catch it and get the appropriate id\n\n\t\t\tvar projEl;\n\n\t\t\tif ( e.target.nodeName === \"SPAN\" ) { projEl = $(e.target).parent(); }\n\t\t\tif ( e.target.nodeName === \"DIV\" ) { projEl = $(e.target); }\n\n\t\t\tvar projData = projEl.data(\"scheduleRecord\");\n\n\n\t\t\tsetProjUnselected( projData );\n\t\t\tsetProjSelected( projData );\n\t\t\tupdateSelectedProjectDisplay();\n\t\t\t\n\t\t});\n\n\t\t$(\"#cnt-worker-grids\").scroll(function () { \n\t\t\t$(\"#cnt-scroll-header\").scrollLeft($(\"#cnt-worker-grids\").scrollLeft());\n\t\t});\n\n\t\t// freeze user name containers in place\n\t\t$('#cnt-worker-grids').scroll(function(e) {\n\t\t\t\tvar pos = $('#cnt-worker-grids').scrollLeft();\n\t\t\t\t$(\".worker-name, #name-placeholder\").css({\n\t\t\t\t\t\tleft: pos\n\t\t\t\t});\n\t\t});\n\n\t\tvar div= document.getElementById('cnt-worker-grids'); // need real DOM Node, not jQuery wrapper\n\t\tvar hasVerticalScrollbar= div.scrollHeight>div.clientHeight;\n\t\tif ( hasVerticalScrollbar ){\n\t\t\t$('#hdr-row').append('<div class=\"accomodate-scrollbar\">&nbsp</div>');\n\t\t}\n\t};\n\n\treturn {\n\t\tnavCal:navCal,\n\t\tclearWorkerDayDivs:clearWorkerDayDivs,\n\t\tclearWorkerScheduleElements:clearWorkerScheduleElements,\n\t\tbldGridHeader:bldGridHeader,\n\t\trenderPlaceHolder:renderPlaceHolder,\n\t\trenderWorkerProj:renderWorkerProj,\n\t\trenderWorkerRow:renderWorkerRow,\n\t\tbuildWorkerDays:buildWorkerDays,\n\t\tbuildWorkerDiv:buildWorkerDiv,\n\t\tsetTagStyles:setTagStyles,\n\t\tinitWorkerDivs:initWorkerDivs,\n\t\tinitScheduleRecords:initScheduleRecords,\n\t\tsetProjSelected:setProjSelected,\n\t\tsetProjUnselected:setProjUnselected,\n\t\tprojectSelected:projectSelected,\n\t\tupdateSelectedProjectDisplay:updateSelectedProjectDisplay,\n\t\tctrlBind:ctrlBind\n  \t};\n\n};\n\n","/*global PWSSchedule, moment, _ */\nPWSSchedule.worker =  function(id, name, projectPool) {\n\t\"use strict\";\n\tvar rows = [];\n\tvar projects = projectPool;\n\t//var schRecPool = [];\n\t//var curentProj;\n\t//var lastAddedProj;\n\t\n\n\tvar getId = function(){\n\t\treturn id;\n\t};\n\n\tvar sortScheduleRecordsAZ = function(recs){\n\t\treturn recs.sort(function(a, b){\n\t\t\ta = new Date(a.scheduled_date);\n\t\t\tb = new Date(b.scheduled_date);\n\t\t\tif (a < b) { return -1; }\n\t\t\telse if (a > b) { return 1; }\n\t\t\telse { return 0; }\n\t\t});\n\t};\n\n\tvar sortScheduleRecordsJobLength = function(recs){\n\t\treturn recs.sort(function(a, b){\n\t\t\ta = a.job_length_days;\n\t\t\tb = b.job_length_days;\n\t\t\tif (a < b) { return -1; }\n\t\t\telse if (a > b) { return 1; }\n\t\t\telse { return 0; }\n\t\t});\n\t};\n\n\tvar buildRows = function(calStart, calRange){\n\t\t//reinit projects;\n\t\trows = [];\n\t\tprojects = projectPool;\n\t\t\n\t\t//clear rows and build new ones based on cal range\n\n\t\tcalStart = ( moment.isMoment( calStart ) ) ? calStart : moment( calStart );\n\n\t\tif ( ! _.isEmpty( projects ) ) {\n\t\t\tprojects = sortScheduleRecordsAZ(projects);\n\t\t}\n\n\t\tvar row;\n\t\twhile ( ! _.isEmpty( projects  ) ){\n\t\t\trow = getRowRecords( projects, calStart, calRange );\n\t\t\tif ( _.isEmpty(row) ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcullProjects(row);\n\t\t\trows.push( row );\n\t\t}\n\t\treturn rows;\n\t};\n\n\n\tvar cullProjects = function(row){\n\t\tvar scheduleIds = [];\n\t\t$.each(row, function( index, value ) {\n\t\t\tscheduleIds.push( value.schedule_id );\n\t\t});\n\n\t\tprojects = projects.filter(function(v){\n\t\t\tif (  $.inArray( v.schedule_id, scheduleIds ) !== -1 ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t};\n\n\n\tvar getRowRecords = function(recs, calStart, calRange){\n\t\tvar lastDate = null;\n\t\tvar newRow = [];\n\n\t\tfor (var i = 0; i < recs.length; i++) { \n\n\t\t\tif ( typeof recs[i] === 'undefined' ) {\n\t\t\t\tthrow new Error('holy shit');\n\t\t\t}\n\n\t\t\t//if record is not within current rendered cal range just skip it\n\t\t\tif ( ! isRecInCalendarRange( recs[i], calStart, calRange )  )  { continue; }\n\t\t\t\n\t\t\tvar momNextStart = moment( recs[i].scheduled_date );\n\n\t\t\t// if its the first row pass just auto add the first record\n\t\t\tif ( lastDate === null ) { //first row pass\n\t\t\t\tnewRow.push( recs[i] );\n\t\t\t\tlastDate = moment ( recs[i].scheduled_date ).add( recs[i].job_length_days, \"days\"  );\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( momNextStart.isAfter( lastDate ) ) {\n\t\t\t\tnewRow.push( recs[i] );\n\t\t\t\tlastDate = moment ( recs[i].scheduled_date ).add( recs[i].job_length_days, \"days\"  );\n\t\t\t}\n\t\t}\n\t\treturn newRow;\n\t};\n\n\tvar isRecInCalendarRange = function(checkRecord, calStart, calRange){\n\t\tvar start = moment(  checkRecord.scheduled_date );\n\t\t//ensure this returns true if either its start or end date are true\n\t\tif ( checkRecord.job_length_days > 1 ) { //check end date as well\n\t\t\tvar end = start.clone().add( checkRecord.job_length_days, 'days' );\n\t\t\tif ( isDateInCalendarRange( start, calStart, calRange ) || isDateInCalendarRange( end, calStart, calRange ) ) { return true; }\n\t\t\treturn false;\n\t\t}\n\t\telse {\n\t\t\tif ( isDateInCalendarRange( start, calStart, calRange ) ) { return true; }\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tvar isDateInCalendarRange = function(checkDate, calStart, calRange){\n\t\tcalStart = ( moment.isMoment( calStart ) ) ? calStart : moment( calStart );\n\t\tvar\tcalEnd = calStart.clone().add( calRange, 'days' );\n\t\tcheckDate =  ( moment.isMoment(checkDate) ) ? checkDate.clone() : moment( checkDate );\n\n\t\tif ( checkDate.isSameOrAfter( calStart  ) && checkDate.isSameOrBefore( calEnd  ) ) { return true; }\n\t\treturn false;\n\t};\n\n\tvar getName = function(){\n\t\treturn name;\n\t};\n\n\n\treturn {\n\t\tid:id,\n\t\tisDateInCalendarRange:isDateInCalendarRange,\n\t\tisRecInCalendarRange:isRecInCalendarRange,\n\t\tsortScheduleRecordsAZ:sortScheduleRecordsAZ,\n\t\tsortScheduleRecordsJobLength:sortScheduleRecordsJobLength,\n\t\tgetRowRecords:getRowRecords,\n\t\tname:name,\n\t\tgetId:getId,\n\t\tgetName:getName,\n\t\tbuildRows:buildRows,\n\t\trows:rows,\n\t\tprojects:projects\n\t};\n\n\n\n\n};\n",""],"sourceRoot":"/source/"}